// ======================
// GLOBAL VARIABLES
// ======================
let cart = [];
const cartCount = document.getElementById('cart-count');
const cartDropdown = document.getElementById('cart-dropdown');
const cartItemsList = document.getElementById('cart-items');
const cartTotalSpan = document.getElementById('cart-total');
const checkoutLink = document.getElementById('checkout-link');

const cookiesBanner = document.getElementById('cookies-banner');
const acceptCookiesBtn = document.getElementById('accept-cookies');

const settingsPanel = document.getElementById('settings-panel');
const settingsIcon = document.getElementById('settings-icon');
const closeSettings = document.getElementById('close-settings');

const themeSelect = document.getElementById('theme-select');
const primaryColorInput = document.getElementById('primary-color');
const secondaryColorInput = document.getElementById('secondary-color');
const animationsToggle = document.getElementById('animations-toggle');

// ======================
// CART FUNCTIONS
// ======================
function addToCart(name, price, sizeSelectId) {
  const size = document.getElementById(sizeSelectId).value;
  cart.push({ name: name + ' (' + size + ')', price: parseFloat(price) });
  updateCartUI();
}

function updateCartUI() {
  cartCount.textContent = cart.length;
  cartItemsList.innerHTML = '';
  let total = 0;
  cart.forEach(item => {
    const li = document.createElement('li');
    li.textContent = `${item.name} - $${item.price.toFixed(2)}`;
    cartItemsList.appendChild(li);
    total += item.price;
  });
  cartTotalSpan.textContent = total.toFixed(2);

  // Prepare mailto checkout
  const name = document.getElementById('customer-name').value || '';
  const email = document.getElementById('customer-email').value || '';
  const address = document.getElementById('customer-address').value || '';
  const card = document.getElementById('customer-card').value || '';
  const exp = document.getElementById('customer-exp').value || '';
  const cvc = document.getElementById('customer-cvc').value || '';

  const subject = encodeURIComponent('Innocent Clothing Order');
  const body = encodeURIComponent(
    `Name: ${name}\nEmail: ${email}\nAddress: ${address}\nCard: ${card}\nExpiry: ${exp}\nCVC: ${cvc}\n\nOrder Items:\n${cart.map(i => i.name + ' - $' + i.price.toFixed(2)).join('\n')}\nTotal: $${total.toFixed(2)}`
  );
  checkoutLink.href = `mailto:davenanother@gmail.com?subject=${subject}&body=${body}`;
}

// Toggle cart dropdown
document.getElementById('cart-icon').addEventListener('click', () => {
  cartDropdown.style.display = cartDropdown.style.display === 'block' ? 'none' : 'block';
});

// ======================
// SETTINGS PANEL
// ======================
settingsIcon.addEventListener('click', () => {
  settingsPanel.style.right = '20px';
});
closeSettings.addEventListener('click', () => {
  settingsPanel.style.right = '-350px';
});

// Theme change
themeSelect.addEventListener('change', () => {
  if (themeSelect.value === 'dark') {
    document.body.classList.add('dark');
    document.body.classList.remove('light');
  } else {
    document.body.classList.add('light');
    document.body.classList.remove('dark');
  }
});

// Primary / Secondary color
primaryColorInput.addEventListener('input', () => {
  document.documentElement.style.setProperty('--primary-color', primaryColorInput.value);
});
secondaryColorInput.addEventListener('input', () => {
  document.documentElement.style.setProperty('--secondary-color', secondaryColorInput.value);
});

// Animations toggle
animationsToggle.addEventListener('change', () => {
  if (animationsToggle.value === 'off') {
    document.body.classList.add('animations-off');
  } else {
    document.body.classList.remove('animations-off');
  }
});

// ======================
// COOKIES BANNER
// ======================
acceptCookiesBtn.addEventListener('click', () => {
  cookiesBanner.style.display = 'none';
});

// ======================
// HASH ROUTING
// ======================
function handleRouting() {
  const hash = window.location.hash || '#home';
  document.querySelectorAll('.page').forEach(page => page.style.display = 'none');
  const target = document.querySelector(hash);
  if (target) target.style.display = 'block';
}
window.addEventListener('hashchange', handleRouting);
window.addEventListener('load', handleRouting);

// ======================
// SCROLL ANIMATIONS
// ======================
const animateElements = document.querySelectorAll('.animate');

function checkAnimation() {
  const triggerBottom = window.innerHeight * 0.85;
  animateElements.forEach(el => {
    const rect = el.getBoundingClientRect();
    if (rect.top < triggerBottom) {
      el.style.opacity = '1';
      el.style.transform = 'translateY(0)';
    }
  });
}
window.addEventListener('scroll', checkAnimation);
window.addEventListener('load', checkAnimation);

// ======================
// OPTIONAL: REMOVE ITEM FROM CART (future expansion)
// ======================
// function removeFromCart(index){
//   cart.splice(index,1);
//   updateCartUI();
// }

// ======================
// OPTIONAL: MULTIPLE PRODUCT CARD ADDITION (future expansion)
// ======================
// function generateProductCard(name, price, imgSrc, sizeId) {
//   // Dynamically create product card elements here
// }

// ======================
// INITIAL CALLS
// ======================
updateCartUI();

